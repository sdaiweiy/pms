(function(f){function l(d,h){var m=h.data,a={},k=[];this.opts=h;this.$container=d;var b=this;this.draw=function(){d.empty().append(k[0].render(h));d.find(".node").click(function(){if(null!==b.opts.onClickNode)b.opts.onClickNode(a[f(this).attr("node-id")])});h.allowEdit&&d.find(".node h2").click(function(a){var c=f(this).parent().attr("node-id");b.startEdit(c);a.stopPropagation()});d.find(".org-add-button").click(function(e){var c=f(this).parent().attr("node-id");if(null!==b.opts.onAddNode)b.opts.onAddNode(a[c]);
else b.newNode(c);e.stopPropagation()});d.find(".org-del-button").click(function(e){var c=f(this).parent().attr("node-id");if(null!==b.opts.onDeleteNode)b.opts.onDeleteNode(a[c]);else b.deleteNode(c);e.stopPropagation()})};this.startEdit=function(e){var c=f('<input class="org-input" type="text" value="'+a[e].data.name+'"/>');d.find("div[node-id="+e+"] h2").replaceWith(c);var g=function(){var g=f("<h2>"+a[e].data.name+"</h2>");h.allowEdit&&g.click(function(){b.startEdit(e)});c.replaceWith(g)};c.focus();
    c.keyup(function(b){13==b.which?g():a[e].data.name=c.val()});c.blur(function(a){g()})};this.newNode=function(e){for(var c=Object.keys(a).length;c in a;)c++;b.addNode({id:c,name:"",pid:e})};this.addNode=function(e){var c=new n(e);a[e.id]=c;a[e.pid].addChild(c);b.draw();b.startEdit(e.id)};this.deleteNode=function(e){for(var c=0;c<a[e].children.length;c++)b.deleteNode(a[e].children[c].data.id);a[a[e].data.pid].removeChild(e);delete a[e];b.draw()};this.getData=function(){var b=[],c;for(c in a)b.push(a[c].data);
    return b};for(var g in m){var l=new n(m[g]);a[m[g].id]=l}for(g in a)0==a[g].data.pid?k.push(a[g]):a[a[g].data.pid].addChild(a[g]);d.addClass("orgChart");b.draw()}function n(d){this.data=d;this.children=[];var h=this;this.addChild=function(d){this.children.push(d)};this.removeChild=function(d){for(var a=0;a<h.children.length;a++)if(h.children[a].data.id==d){h.children.splice(a,1);break}};this.render=function(d){var a=h.children.length;var f="<table cellpadding='0' cellspacing='0' border='0'>"+("<tr><td colspan='"+
    (0<a?2*a:2)+"'>"+h.formatNode(d)+"</td></tr>");if(0<a){for(var b="",g=0;g<a;g++)b=1==a?b+"<td class='line left half'></td>":0==g?b+"<td class='line left'></td>":b+"<td class='line left top'></td>",b=1==a?b+"<td class='line right half'></td>":g==a-1?b+"<td class='line right'></td>":b+"<td class='line right top'></td>";f=f+("<tr class='lines'><td colspan='"+2*a+"'><table cellpadding='0' cellspacing='0' border='0'><tr class='lines x'><td class='line left half'></td><td class='line right half'></td></table></td></tr>")+
    ("<tr class='lines v'>"+b+"</tr>")+"<tr>";for(g in h.children)f+="<td colspan='2'>"+h.children[g].render(d)+"</td>";f+="</tr>"}return f+="</table>"};this.formatNode=function(f){var a="",k="";"undefined"!==typeof d.name&&(a="<h2>"+h.data.name+"</h2>");"undefined"!==typeof d.description&&(k="<p>"+h.data.description+"</p>");return"<div class='node' node-id='"+this.data.id+"'>"+a+k+(f.showControls?"<div class='org-add-button'>"+f.newNodeText+"</div><div class='org-del-button'></div>":"")+"</div>"}}f.fn.orgChart=
    function(d){d=f.extend({},f.fn.orgChart.defaults,d);return new l(f(this),d)};f.fn.orgChart.defaults={data:[{id:1,name:"Root",pid:0}],showControls:!1,allowEdit:!1,onAddNode:null,onDeleteNode:null,onClickNode:null,newNodeText:"Add Child"}})(jQuery);